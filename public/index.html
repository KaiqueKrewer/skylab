<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Inventário de Jogos</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    th { background-color: #eee; }
  </style>
</head>
<body>
  <h1>Inventário de Jogos</h>
  <form id="formJogo">
    <input type="hidden" id="id" />
    <input type="text" id="nome" placeholder="Nome do jogo" required />
    <input type="text" id="plataforma" placeholder="Plataforma" required />
    <select id="status" required>
      <option value="">Status</option>
      <option value="completo">Completo</option>
      <option value="em andamento">Em andamento</option>
      <option value="não iniciado">Não iniciado</option>
    </select>
    <button type="submit">Adicionar Jogo</button>
  </form>
  <table id="tabelaJogos">
    <thead><tr><th>ID</th><th>Nome</th><th>Plataforma</th><th>Status</th><th>Ações</th></tr></thead>
    <tbody></tbody>
  </table>
  <script>
const apiBase = '/inventario-jogos/skylab/public';

async function listarJogos() {
  const res = await fetch(`${apiBase}/jogos`);
  const jogos = await res.json();
  const tbody = document.querySelector('#tabelaJogos tbody');
  tbody.innerHTML = '';
  jogos.forEach(j => {
    tbody.innerHTML += `<tr>
      <td>${j.id}</td><td>${j.nome}</td><td>${j.plataforma}</td><td>${j.status}</td>
      <td><button onclick="editarJogo(${j.id})">Editar</button><button onclick="deletarJogo(${j.id})">Excluir</button></td>
    </tr>`;
  });
}

function limparFormulario() {
  document.getElementById('id').value = '';
  document.getElementById('nome').value = '';
  document.getElementById('plataforma').value = '';
  document.getElementById('status').value = '';
  document.querySelector('#formJogo button').textContent = 'Adicionar Jogo';
}

async function deletarJogo(id) {
  await fetch(`${apiBase}/jogos/${id}`, { method: 'DELETE' });
  listarJogos();
}

async function editarJogo(id) {
  const res = await fetch(`${apiBase}/jogos/${id}`);
  const j = await res.json();
  document.getElementById('id').value = j.id;
  document.getElementById('nome').value = j.nome;
  document.getElementById('plataforma').value = j.plataforma;
  document.getElementById('status').value = j.status;
  document.querySelector('#formJogo button').textContent = 'Atualizar Jogo';
}

document.getElementById('formJogo').addEventListener('submit', async e => {
  e.preventDefault();
  const id = document.getElementById('id').value;
  const data = {
    nome: document.getElementById('nome').value,
    plataforma: document.getElementById('plataforma').value,
    status: document.getElementById('status').value,
  };
  const method = id ? 'PUT' : 'POST';
  const url = id ? `${apiBase}/jogos/${id}` : `${apiBase}/jogos`;
  await fetch(url, {
    method,
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data),
  });
  limparFormulario();
  listarJogos();
});

listarJogos();
  </script>
</body>
</html>